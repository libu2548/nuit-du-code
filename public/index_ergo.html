<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Psychedelic Keyboard ‚Äî Input Challenge</title>
  <link rel="stylesheet" href="style_ergo.css">
  <link rel="stylesheet" href="snake-styles_ergo.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
  <main class="wrap">
    <h1>Psychedelic Keyboard</h1>
    
    <div class="controls">
      
      <label for="targetInput">Notes (easter eggpossible ) :</label>
      <input id="targetInput" type="text" readonly aria-label="Sortie des caract√®res">

      <div class="actions">
        <button id="clearBtn" type="button">Effacer sortie</button>
        <button id="resetMapBtn" type="button">R√©initialiser mapping</button>
      </div>

      <p class="hint">Utilisez votre clavier physique. Chaque touche physique ins√®re un caract√®re al√©atoire et le mapping est reg√©n√©r√© imm√©diatement.</p>
    </div>

    <section class="keyboard-section">
      <div class="keyboard" id="keyboard" aria-hidden="true">
        <!-- AZERTY letters-only layout -->
        <!-- Row 1: A Z E R T Y U I O P -->
        <div class="keyboard-row">
          <div class="key" data-key="a">a</div>
          <div class="key" data-key="z">z</div>
          <div class="key" data-key="e">e</div>
          <div class="key" data-key="r">r</div>
          <div class="key" data-key="t">t</div>
          <div class="key" data-key="y">y</div>
          <div class="key" data-key="u">u</div>
          <div class="key" data-key="i">i</div>
          <div class="key" data-key="o">o</div>
          <div class="key" data-key="p">p</div>
        </div>

        <!-- Row 2: Q S D F G H J K L M -->
        <div class="keyboard-row">
          <div class="key" data-key="q">q</div>
          <div class="key" data-key="s">s</div>
          <div class="key" data-key="d">d</div>
          <div class="key" data-key="f">f</div>
          <div class="key" data-key="g">g</div>
          <div class="key" data-key="h">h</div>
          <div class="key" data-key="j">j</div>
          <div class="key" data-key="k">k</div>
          <div class="key" data-key="l">l</div>
          <div class="key" data-key="m">m</div>
        </div>

        <!-- Row 3: Shift W X C V B N -->
        <div class="keyboard-row">
          <div class="key shift-key" id="shiftKey" data-key="Shift">SHIFT</div>
          <div class="key" data-key="w">w</div>
          <div class="key" data-key="x">x</div>
          <div class="key" data-key="c">c</div>
          <div class="key" data-key="v">v</div>
          <div class="key" data-key="b">b</div>
          <div class="key" data-key="n">n</div>
        </div>

        <!-- Spacebar and Caps Lock row -->
        <div class="keyboard-row">
          <button id="capsLockBtn" class="key caps-lock-key" type="button">CAPS LOCK</button>
          <div class="key space" data-key=" ">space</div>
        </div>
      </div>
    </section>

    <section class="status">
      <p>Mapping actuel visible sur les touches ‚Äî il change apr√®s chaque frappe.</p>
      <p id="matchHint" class="matchHint"></p>
    </section>

  </main>

  <!-- Hidden Snake Game Container -->
  <div id="snakeGameContainer" class="snake-game-container">
    <div class="snake-game-wrapper">
      <h2>üêç SNAKE GAME üêç</h2>
      <canvas id="snakeCanvas" width="400" height="400"></canvas>
      <p class="snake-info">D√©marrage: <span id="snakeCountdown"></span> Score: <span id="snakeScore">0</span> | Press any key to exit</p>
    </div>
  </div>

  <script src="snake-game_ergo.js" defer></script>
  <script src="script_ergo.js" defer></script>
  <script>
    // Envoi au parent uniquement lors de l'appui sur "Entr√©e" ‚Äî envoie seulement la sortie (pas le mapping)
    (function(){
      function sendNote(text){
        try { window.parent.postMessage({ type: 'note', text: text }, '*'); }
        catch(e){ /* ignore */ }
      }

      // Envoie la note lorsque l'utilisateur presse Entr√©e (dans la page)
      window.addEventListener('keydown', (ev) => {
        if(ev.key === 'Enter'){
          const targetInput = document.getElementById('targetInput');
          const out = targetInput ? targetInput.value : '';
          // n'envoyer que la valeur de sortie
          sendNote(out);
        }
      });

      // Expose pour debug si besoin
      window.__sendNoteToParent = sendNote;
    })();
  </script>
</body>
</html>
